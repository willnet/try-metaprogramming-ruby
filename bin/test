#!/usr/bin/env bash

# Ruby-first ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ
# Ruby ãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›´ã‚’ JavaScript ã«åŒæœŸã—ã¦ã‹ã‚‰ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™

set -e

# ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å–å¾—
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«ç§»å‹•
cd "$PROJECT_ROOT"

echo "ğŸ”„ Syncing Ruby files to JavaScript..."
node scripts/sync-ruby-to-js.js

echo ""
echo "ğŸ“Š Generating test problems JSON..."
node scripts/generate-test-json.js

echo ""
echo "ğŸ§ª Running comprehensive answer tests..."
ruby test/test_answers_comprehensive.rb

# å¼•æ•°ãŒæ¸¡ã•ã‚ŒãŸå ´åˆã€ç‰¹å®šã®å•é¡Œã‚’ãƒ†ã‚¹ãƒˆ
if [ $# -eq 2 ]; then
    echo ""
    echo "ğŸ¯ Testing specific problem: $1/$2"
    ruby test/test_answers_comprehensive.rb "$1" "$2"
fi

echo ""
echo "âœ… All tests completed!"